<!-- image header -->
<header>
  <div id="img-header" class="contact"></div>
</header>

<app-mission-info-panel></app-mission-info-panel>

<!-- content -->
<section>
  <!-- title -->
  <div class="content-title">
    <h1 class="title">Liste des joueurs</h1>
  </div>

  <!-- content -->
  <div class="content">
    <div class="columns">
      <div class="column">
        <small>
          Liste des joueurs inscrit pour l'<b>Opération Rogue Wave Piercer</b>.
        </small>
        <br /><br />

        <table
          class="table is-bordered is-hoverable is-fullwidth"
          *ngIf="mission"
        >
          <thead>
            <tr>
              <th>#</th>
              <th>Équipe</th>
              <th>Nom</th>
              <th>Joueur</th>
              <th *ngIf="playerLogged$ | async"></th>
            </tr>
          </thead>
        </table>
        <div *ngIf="mission && teams">
          <div *ngFor="let team of getObjKey(teams)">
            <h6>{{ team }} :</h6>
            <table class="table is-bordered is-hoverable is-fullwidth">
              <tbody *ngFor="let role of mission.roles">
                <tr
                  *ngIf="
                    role.team.name.trim().normalize() ===
                    team.trim().normalize()
                  "
                >
                  <th>{{ role.id }}</th>
                  <td>{{ role.team.name }}</td>
                  <td>{{ role.name }}</td>
                  <td>
                    <span *ngIf="role.player">
                      {{ role.player.username }}
                    </span>
                  </td>
                  <td *ngIf="playerLogged$ | async">
                    <button
                      routerLink="{{ role.id }}"
                      class="button is-small is-outlined is-light is-info"
                      *ngIf="(playerLogged$ | async).isAdmin"
                    >
                      Editer
                    </button>
                    <button
                      (click)="kick(role.id)"
                      class="button is-small is-outlined is-light is-danger"
                      *ngIf="
                        (playerLogged$ | async).isAdmin &&
                        role.player &&
                        role.player.id !== (playerLogged$ | async).id
                      "
                    >
                      Exclure
                    </button>
                    <button
                      class="button is-small is-outlined is-light is-warning"
                      (click)="leaveMission(role)"
                      *ngIf="
                        role.player &&
                        role.player.id === (playerLogged$ | async).id
                      "
                    >
                      Déserter
                    </button>
                    <button
                      class="button is-small is-outlined is-light is-primary"
                      (click)="joinMission(role)"
                      *ngIf="
                        dateValid() &&
                        !isAlreadyRegistered &&
                        !role.player &&
                        evalCondition(role)
                      "
                    >
                      S'inscrire
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <button
          routerLink="0"
          class="button is-fullwidth is-link"
          *ngIf="(playerLogged$ | async)?.isAdmin"
        >
          Ajout d'un slot
        </button>
      </div>
    </div>
  </div>
</section>
